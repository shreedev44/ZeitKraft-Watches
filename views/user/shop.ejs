<%- include('../layout/header') -%>
<title>ZEITKRAFT | Shop</title>

    <%- include('../layout/userSideCss') %>
</head>

<body>
<%- include('../layout/navbar') -%>

<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="/home">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="shop spad">
    <div class="container">
        <div class="row"  id="sort-pagination-div">
            <div class="col-lg-3">
                <div class="shop__sidebar">
                    <!-- Search Form -->
                    <div class="shop__sidebar__search">
                        <form action="/shop" method="get">
                            <input type="text" name="search" placeholder="Search..." id="search-box">
                            <button type="submit"><span class="icon_search"></span></button>
                        </form>
                    </div>
            
                    <!-- Filter Form -->
                    <form id="filterForm">
                        <% if (search) { %>
                            <input type="hidden" name="search" value="<%= search %>" class="d-none">
                        <% } %>
                        <div class="d-flex justify-content-center">
                            <button type="submit" class="btn btn-primary my-2">Apply Filters</button>
                        </div>
                        <div class="shop__sidebar__accordion" id="accordionExample">
                            <!-- Categories Filter -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseOne">Categories</a>
                                </div>
                                <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul class="nice-scroll" id="category">
                                                <% categories.forEach((category) => { %>
                                                <li>
                                                    <input type="checkbox" name="categories" value="<%= category.categoryName %>">
                                                    <span class="filter ml-2"><%= category.categoryName %></span>
                                                </li>
                                                <% }) %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Brands Filter -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseTwo">Brands</a>
                                </div>
                                <div id="collapseTwo" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul id="brand">
                                                <% brands.forEach((brand) => { %>
                                                <li>
                                                    <input type="checkbox" name="brands" value="<%= brand.brandName %>">
                                                    <span class="filter ml-2"><%= brand.brandName %></span>
                                                </li>
                                                <% }) %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Types Filter -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseFive">Types</a>
                                </div>
                                <div id="collapseFive" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul id="type">
                                                <li>
                                                    <input type="checkbox" name="types" value="Automatic">
                                                    <span class="filter ml-2">Automatic</span>
                                                </li>
                                                <li>
                                                    <input type="checkbox" name="types" value="Manual">
                                                    <span class="filter ml-2">Manual</span>
                                                </li>
                                                <li>
                                                    <input type="checkbox" name="types" value="Quartz">
                                                    <span class="filter ml-2">Quartz</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Dial Colors Filter -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseThree">Dial Colors</a>
                                </div>
                                <div id="collapseThree" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul id="dialColor">
                                                <% dialColors.forEach((color) => { %>
                                                <li>
                                                    <input type="checkbox" name="dialColors" value="<%= color %>">
                                                    <span class="filter ml-2"><%= color %></span>
                                                </li>
                                                <% }) %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Strap Colors Filter -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseFour">Strap Colors</a>
                                </div>
                                <div id="collapseFour" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__brand">
                                            <ul id="strapColor">
                                                <% strapColors.forEach((color) => { %>
                                                <li>
                                                    <input type="checkbox" name="strapColors" value="<%= color %>">
                                                    <span class="filter ml-2"><%= color %></span>
                                                </li>
                                                <% }) %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Filter Price -->
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" href="#collapseSix">Filter Price</a>
                                </div>
                                <div id="collapseSix" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__price">
                                            <label for="minPrice">Minimum Price:</label>
                                            <input type="text" id="minPrice" name="minPrice" pattern="^\d+(\.\d{1,2})?$">
                                            <br>
                                            <label for="maxPrice">Maximum Price:</label>
                                            <input type="text" id="maxPrice" name="maxPrice" pattern="^\d+(\.\d{1,2})?$">
                                            <br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="col-lg-9" id="sort-pagination-div">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left" id="filter-resuls">
                                <p><%= products.length %> results</p>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right mr-2">
                                <p>Sort by:</p>
                                <select id="sortSelect" name="sort">
                                    <option value="addedDate-desc">Select</option>
                                    <option value="price-asc">Price ↑</option>
                                    <option value="price-desc">Price ↓</option>
                                    <option value="brand.brandName-asc">Product Name ↑</option>
                                    <option value="brand.brandName-desc">Product Name ↓</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            
                <div class="row" id="parent-div">
                    <% products.forEach((product) => { %>
                        <% let  offer = 0 %>
                    <div class="col-lg-4 col-md-6 col-sm-6 ftco-animate">
                        <div class="product">
                            <a href="/product-details?productId=<%= product._id %>" class="img-prod"><img class="img-fluid" src="/uploads/products/<%= product.productPic1 %>" alt="Product image">
                                <% if(product.offerPercent){ %>
                                    <% offer = product.offerPercent %>
                                <% } %>
                                <% if(product.category[0].offerPercent){ %>
                                    <% offer = product.category[0].offerPercent > offer ? product.category[0].offerPercent : offer %>
                                <% } %>
                                <% if(product.brand[0].offerPercent){ %>
                                    <% offer = product.brand[0].offerPercent > offer ? product.brand[0].offerPercent : offer %>
                                <% } %>
                                <% if(offer > 0){ %>
                                <span class="status text-light">-<%= offer %>%</span>
                                <% } %>
                                <div class="overlay"></div>
                            </a>
                            <div class="text py-3 px-3">
                                <h3><a class="text-primary" href="/product-details?productId=<%= product._id %>"><%= products[products.indexOf(product)].brand[0].brandName + " " + product.productName %></a></h3>
                                <p></p>
                                <h6><%= product.model %></h6>
                                <p></p>
                                <div class="d-flex">
                                    <div class="pricing">
                                        <% const formattedPrice = product.price.toLocaleString(); %>
                                        
                                        <p class="price <%= offer > 0 ? 'strike' : '' %>"><span>&#x20b9; <%= formattedPrice %></span></p>
                                        <% if(offer > 0){ %>
                                        <p class="price"><span>&#x20b9; <%= (product.price - product.price * offer / 100).toLocaleString() %></span></p>
                                        <% } %>
                                    </div>
                                    <div class="rating">
                                        <p class="text-right">
                                            <span class="ion-ios-star-outline"></span>
                                            <span class="ion-ios-star-outline"></span>
                                            <span class="ion-ios-star-outline"></span>
                                            <span class="ion-ios-star-outline"></span>
                                            <span class="ion-ios-star-outline"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-around">
                                    <% if(product.stock > 5){ %>
                                    <span class="text-success">In stock</span>
                                    <% }else if(product.stock <= 5 && product.stock >0) {%>
                                    <span class="text-warning">Few stock left</span>
                                    <% }else{ %>
                                    <span class="text-danger">Out of stock</span>
                                    <% } %>
                                    <p class="text-dark fw-bolder"><%= product.type %></p>
                                </div>
                                <p class="bottom-area d-flex px-3">
                                    <% if(product.stock > 0){ %>
                                    <a data-product-id="<%= product._id %>" class="add-to-cart text-center py-2 mr-1"><span data-product-id="<%= product._id %>" class="add-to-cart" style="cursor: pointer;">Add to cart <i class="ion-ios-add ml-1"></i></span></a>
                                    <% } %>
                                    <a data-product-id="<%= product._id %>" class="add-to-wishlist buy-now text-center py-2" style="cursor: pointer;">Wishlist<span><i class="ion-ios-heart ml-1"></i></span></a>
                                </p>
                            </div>
                        </div>
                    </div>
                    <% }) %>
                </div>
            
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__pagination">
                            <% for(let i = 1; i <= totalPages; i++){ %>
                            <a class="<%= pageNumber == i ? 'active' : '' %> pagination" href="#" data-page="<%= i %>"><%= i %></a>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<%- include('../layout/pageFooter') -%>
<%- include('../layout/userSideScripts') %>

<script src="/UserAssets/js/shop.js"></script>
<%- include('../layout/footer') -%>